{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap f31f3fe37dc96b86ca3f","webpack:///./src/utils/index.js","webpack:///./src/utils/streamy.js","webpack:///./src/index.js","webpack:///./src/utils/streamy-dom.js","webpack:///./test/helpers/test-component.js","webpack:///./~/deep-equal/index.js","webpack:///./~/deep-equal/lib/is_arguments.js","webpack:///./~/deep-equal/lib/keys.js","webpack:///./src/utils/router.js","webpack:///./src/utils/streamy-helpers.js","webpack:///./src/utils/streamy-hyperscript.js"],"names":["merge$","isStream","stream","init_value","s","value","undefined","update","IS_STREAM","listeners","map","fn","is","cur","flatMap","filter","deepSelect","distinct","$","selectorArr","query","until","stopEmit$","patch","partialChange","reduce","startValue","valuesChanged","oldValue","newValue","parent$","notifyListeners","forEach","notifyListener","listener","fork$","mapFunction","initValue","newStream","push","mapValue","result$","updateOuterStream","result","attachToResult$","mapFn","parentValue","getChildStreamValue","flatMapValue","removeItem","filterValue","selector","selectors","split","select","parent","input","deepSelectValue","Array","isArray","a","b","Object","assign","stopEmitValues$","subscribeTo","stopEmitValues","aggregate","reduceValue","potentialStreamsArr","values","indexOf","potentialStream","index","updateMergedStream","arr","item","splice","render","diff","createNode","TEXT_NODE","parentElement","vdom$","renderUpdate","oldElement","element","oldVersion","version","oldChildren","children","tag","props","appendChild","triggerLifecycle","copyChildren","newChildren","newVersion","newElement","isTextNode","updateTextNode","nodeTypeDiffers","replaceChild","diffAttributes","diffChildren","getOwnPropertyNames","applyPropertyToElement","attribute","applyAttribute","cleanupAttributes","className","style","removeAttribute","unifyChildren","child","cycle","oldChildNodes","childNodes","unifiedChildren","unifiedOldChildren","length","i","oldChildChildren","remaining","childToRemove","removeChild","console","log","document","createTextNode","createElement","JSON","parse","stringify","event","nodeName","toLowerCase","window","Text","nodeValue","test","schedule","done","iteration","Error","pSlice","prototype","slice","objectKeys","require","isArguments","deepEqual","module","exports","actual","expected","opts","Date","getTime","strict","objEquiv","isUndefinedOrNull","isBuffer","x","copy","key","call","ka","kb","e","sort","supportsArgumentsClass","toString","arguments","supported","unsupported","object","hasOwnProperty","propertyIsEnumerable","keys","shim","obj","Router","initRouter","interceptLinks","routerState$","interceptClickEvent","target","srcElement","tagName","href","getAttribute","isLocal","startsWith","isAnchor","parseLink","anchor","route","goTo","preventDefault","onpopstate","state","dispatchRouteChange","addEventListener","location","pathname","search","hash","getUrlParams","urlRegex","regExResultHash","RegExp","exec","regExResultSearch","vars","concat","params","pair","decodeURIComponent","children$","router$","routes","sanitizedRoute$","routeWasHit$","wasHit","link","regexp","matchArr","substr","history","pushState","if$","join$","promise$","promise","output$","loading","error","data","then","onTrue","onFalse","$arr","join","flatten","h","component","mergedChildren$","mergeChildren$","propName","wrapProps$","_","childrenVdom$arr","getChildrenVdom$arr","childrenArr","children$Arr","makeArray","vdomArr","makeStreams","array","mutable","arrayTypeStr","nodes","node","pop","apply","reverse","nestedStreams","extractNestedStreams","updateStreams","makeNestedStreamUpdateProps"],"mappings":"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","file":"zliq.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"zliq\"] = factory();\n\telse\n\t\troot[\"zliq\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f31f3fe37dc96b86ca3f","export * from './streamy';\r\nexport * from './streamy-dom';\r\nexport * from './streamy-hyperscript';\r\nexport * from './streamy-helpers';\r\nexport * from './router';\n\n\n// WEBPACK FOOTER //\n// ./src/utils/index.js","import deepEqual from 'deep-equal';\r\n\r\n/*\r\n* stream constructor\r\n* constructor returns a stream\r\n* get the current value of stream like: stream.value\r\n*/\r\nexport const stream = function(init_value) {\r\n\tlet s = function(value) {\r\n\t\tif (value === undefined) {\r\n\t\t\treturn s.value;\r\n\t\t}\r\n\t\tupdate(s, value);\r\n\t\treturn s;\r\n\t}\r\n\r\n\ts.IS_STREAM = true;\r\n\ts.value = init_value;\r\n\ts.listeners = [];\r\n\r\n\ts.map = (fn) => map(s, fn);\r\n\ts.is = (value) => map(s, (cur) => cur === value);\r\n\ts.flatMap = (fn) => flatMap(s, fn);\r\n\ts.filter = (fn) => filter(s, fn);\r\n\ts.deepSelect = (fn) => deepSelect(s, fn);\r\n\ts.distinct = (fn) => distinct(s, fn);\r\n\ts.$ = (selectorArr) => query(s, selectorArr);\r\n\ts.until = (stopEmit$) => until(s, stopEmit$);\r\n\ts.patch = (partialChange) => patch(s, partialChange);\r\n\ts.reduce = (fn, startValue) => reduce(s, fn, startValue);\r\n\r\n\treturn s;\r\n};\r\n\r\n/*\r\n* wrapper for the diffing of stream values\r\n*/\r\nfunction valuesChanged(oldValue, newValue) {\r\n\treturn !deepEqual(oldValue, newValue);\r\n}\r\n\r\n/*\r\n* update the stream value and notify listeners on the stream\r\n*/\r\nfunction update(parent$, newValue) {\r\n\tparent$.value = newValue;\r\n\tnotifyListeners(parent$.listeners, newValue);\r\n};\r\n\r\n/*\r\n* provide a new value to all listeners registered for a stream\r\n*/\r\nfunction notifyListeners(listeners, value) {\r\n\tlisteners.forEach(function notifyListener(listener) {\r\n\t\tlistener(value);\r\n\t});\r\n}\r\n\r\n/*\r\n* Do not pipe the value undefined. This allows to wait for an external initialization.\r\n* It also saves you from checking for an initial null on every map function.\r\n*/\r\nfunction fork$(parent$, mapFunction) {\r\n\tlet initValue = parent$.value !== undefined ? mapFunction(parent$.value) : undefined\r\n\treturn stream(initValue);\r\n}\r\n\r\n/*\r\n* provides a new stream applying a transformation function to the value of a parent stream\r\n*/\r\nfunction map(parent$, fn) {\r\n\tlet newStream = fork$(parent$, fn);\r\n\tparent$.listeners.push(function mapValue(value) {\r\n\t\tnewStream(fn(value));\r\n\t});\r\n\treturn newStream;\r\n}\r\n\r\n/*\r\n* provides a new stream applying a transformation function to the value of a parent stream\r\n*/\r\nfunction flatMap(parent$, fn) {\r\n\tlet result$;\r\n\tlet listener = function updateOuterStream(result) {\r\n\t\tnewStream(result);\r\n\t};\r\n\tfunction attachToResult$(mapFn, parentValue, listener) {\r\n\t\tlet result$ = mapFn(parentValue);\r\n\t\tresult$.listeners.push(listener);\r\n\t\treturn result$;\r\n\t}\r\n\tlet newStream = fork$(parent$, function getChildStreamValue(value) {\r\n\t\tresult$ = attachToResult$(fn, value, listener);\r\n\t\treturn result$.value;\r\n\t});\r\n\tparent$.listeners.push(function flatMapValue(value) {\r\n\t\t// clean up listeners or they will stack on child streams\r\n\t\tif (result$) {\r\n\t\t\tremoveItem(result$.listeners, listener);\r\n\t\t}\r\n\r\n\t\tresult$ = attachToResult$(fn, value, listener);\r\n\t\tnewStream(result$.value);\r\n\t});\r\n\treturn newStream;\r\n}\r\n\r\n/*\r\n* provides a new stream that only serves the values that a filter function returns true for\r\n* still a stream ALWAYS has a value -> so it starts at least with NULL\r\n*/\r\nfunction filter(parent$, fn) {\r\n\tlet newStream = fork$(parent$, (value) => fn(value) ? value : undefined);\r\n\tparent$.listeners.push(function filterValue(value) {\r\n\t\tif (fn(value)) {\r\n\t\t\tnewStream(value);\r\n\t\t}\r\n\t});\r\n\treturn newStream;\r\n}\r\n\r\n/*\r\n* provides a new stream that has a selected sub property of the object value of the parent stream\r\n* the selector has the format [{propertyName}.]*\r\n*/\r\nfunction deepSelect(parent$, selector) {\r\n\tlet selectors = selector.split('.');\r\n\r\n\tfunction select(parent, selectors) {\r\n\t\treturn selectors.reduce((input, selector) => {\r\n\t\t\treturn input[selector];\r\n\t\t}, parent);\r\n\t}\r\n\r\n\tlet newStream = fork$(parent$, (value) => select(value, selectors));\r\n\tparent$.listeners.push(function deepSelectValue(newValue) {\r\n\t\tnewStream(select(newValue, selectors));\r\n\t});\r\n\treturn newStream;\r\n};\r\n\r\nfunction query(parent$, selectorArr) {\r\n\tif(!Array.isArray(selectorArr)) {\r\n\t\treturn deepSelect(parent$, selectorArr);\r\n\t}\r\n\treturn merge$(selectorArr.map(selector => deepSelect(parent$, selector)));\r\n}\r\n\r\n// TODO: maybe refactor with filter\r\n/*\r\n* provide a new stream that only notifys its children if the containing value actualy changes\r\n*/\r\nfunction distinct(parent$, fn = (a, b) => valuesChanged(a, b)) {\r\n\tlet newStream = fork$(parent$, (value) => value);\r\n\tparent$.listeners.push(function deepSelectValue(value) {\r\n\t\tif (fn(newStream.value, value)) {\r\n\t\t\tnewStream(value);\r\n\t\t}\r\n\t});\r\n\treturn newStream;\r\n}\r\n\r\n/*\r\n* update only the properties of an object passed\r\n* i.e. {name: 'Fabian', lastname: 'Weber} patched with {name: 'Fabo'} produces {name: 'Fabo', lastname: 'Weber}\r\n*/\r\nfunction patch(parent$, partialChange) {\r\n\tif (parent$.value == null) {\r\n\t\tparent$(partialChange);\r\n\t\treturn;\r\n\t}\r\n\treturn parent$(Object.assign({}, parent$.value, partialChange));\r\n}\r\n\r\nfunction until(parent$, stopEmitValues$) {\r\n\tlet newStream = stream(stopEmitValues$.value ? undefined : parent$.value);\r\n\tlet subscribeTo = (stream) => {\r\n\t\tnewStream(parent$.value);\r\n\t\tstream.listeners.push(newStream);\r\n\t}\r\n\tstopEmitValues$.map(stopEmitValues => {\r\n\t\tif(stopEmitValues) {\r\n\t\t\tremoveItem(parent$.listeners, newStream);\r\n\t\t} else {\r\n\t\t\tsubscribeTo(parent$);\r\n\t\t}\r\n\t});\r\n\treturn newStream;\r\n}\r\n\r\n/*\r\n* reduce a stream over time\r\n* this will pass the last output value to the calculation function\r\n* reads like the array reduce function\r\n*/\r\nfunction reduce(parent$, fn, startValue) {\r\n\tlet aggregate = parent$.value !== undefined ? fn(startValue, parent$.value) : undefined;\r\n\tlet newStream = stream(aggregate);\r\n\tparent$.listeners.push(function reduceValue(value) {\r\n\t\taggregate = fn(aggregate, parent$.value);\r\n\t\tnewStream(aggregate);\r\n\t});\r\n\treturn newStream;\r\n}\r\n\r\n/*\r\n* merge several streams into one stream providing the values of all streams as an array\r\n* accepts also non stream elements, those are just copied to the output\r\n* the merge will only have a value if every stream for the merge has a value\r\n*/\r\nexport function merge$(potentialStreamsArr) {\r\n\tlet values = potentialStreamsArr.map(parent$ => parent$ && parent$.IS_STREAM ? parent$.value : parent$);\r\n\tlet newStream = stream(values.indexOf(undefined) === -1 ? values : undefined);\r\n\r\n\tpotentialStreamsArr.forEach((potentialStream, index) => {\r\n\t\tif (potentialStream.IS_STREAM) {\r\n\t\t\tpotentialStream.listeners.push(function updateMergedStream(value) {\r\n\t\t\t\tvalues[index] = value;\r\n\t\t\t\tnewStream(values.indexOf(undefined) === -1 ? values : undefined);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\treturn newStream;\r\n}\r\n\r\nexport function isStream(parent$) {\r\n\treturn parent$ != null && !!parent$.IS_STREAM;\r\n}\r\n\r\nfunction removeItem(arr, item) {\r\n\tvar index = arr.indexOf(item);\r\n\tif (index !== -1) {\r\n\t\tarr.splice(index, 1);\r\n\t}\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/streamy.js","export * from './utils';\r\nexport * from '../test/helpers/test-component';\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import {isStream} from './streamy';\r\n\r\nconst TEXT_NODE = '#text';\r\n\r\nexport function render({vdom$}, parentElement) {\r\n\treturn vdom$.reduce(\r\n\t\tfunction renderUpdate({element:oldElement, version:oldVersion, children:oldChildren}, {tag, props, children, version}) {\r\n\t\t\tif (oldElement === null) {\r\n\t\t\t\toldElement = createNode(tag, children);\r\n\t\t\t\tif (parentElement) {\r\n\t\t\t\t\tparentElement.appendChild(oldElement);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdiff(oldElement, tag, props, children, version, oldChildren, oldVersion);\r\n\r\n\t\t\t// signalise mount of root element on initial render\r\n\t\t\tif (parentElement && version === 0) {\r\n\t\t\t\ttriggerLifecycle(oldElement, props, 'mounted');\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\telement: oldElement,\r\n\t\t\t\tversion,\r\n\t\t\t\tchildren: copyChildren(children)\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\telement: null,\r\n\t\t\tversion: -1,\r\n\t\t\tchildren: []\r\n\t\t})\r\n}\r\n\r\nexport function diff(oldElement, tag, props, newChildren, newVersion, oldChildren, oldVersion) {\r\n\t// if the dom-tree hasn't changed, don't process it\r\n\t// !! does not work\r\n\t// if (newVersion === oldVersion) {\r\n\t// // if (newVersion === oldVersion) {\r\n\t// \treturn oldElement;\r\n\t// }\r\n\tlet newElement = oldElement;\r\n\r\n\tif (isTextNode(oldElement) && tag === TEXT_NODE ) {\r\n\t\tupdateTextNode(newElement, newChildren[0]);\r\n\t\treturn newElement;\r\n\t}\r\n\r\n\t// if the node types do not differ, we reuse the old node\r\n\tif (nodeTypeDiffers(oldElement, tag)) {\r\n\t\tnewElement = createNode(tag, newChildren);\r\n\t\toldElement.parentElement.replaceChild(newElement, oldElement);\r\n\t\toldChildren = [];\r\n\t\toldVersion = -1;\r\n\t}\r\n\r\n\tdiffAttributes(newElement, props);\r\n\r\n\t// text nodes have no real child-nodes, but have a string value as first child\r\n\tif (tag !== TEXT_NODE) {\r\n\t\tdiffChildren(newElement, newChildren, oldChildren);\r\n\t}\r\n\t\r\n\tif (newVersion === 0) {\r\n\t\ttriggerLifecycle(newElement, props, 'created');\r\n\t}\r\n\r\n\tif (newVersion > 0) {\r\n\t\ttriggerLifecycle(newElement, props, 'updated');\r\n\t}\r\n\r\n\treturn newElement;\r\n}\r\n\r\nfunction diffAttributes(element, props) {\r\n\tif (props !== undefined) {\r\n\t\tObject.getOwnPropertyNames(props).map(function applyPropertyToElement(attribute) {\r\n\t\t\tapplyAttribute(element, attribute, props[attribute])\r\n\t\t});\r\n\t\tcleanupAttributes(element, props);\r\n\t}\r\n}\r\n\r\nfunction applyAttribute(element, attribute, value) {\r\n\tif (attribute === 'class' || attribute === 'className') {\r\n\t\telement.className = value;\r\n\t// we leave the possibility to define styles as strings\r\n\t// but we allow styles to be defined as an object\r\n\t} else if (attribute === 'style' && typeof value !== \"string\" ) {\r\n\t\tObject.assign(element.style, value);\r\n\t// other propertys are just added as is to the DOM\r\n\t} else {\r\n\t\t// also remove attributes on null to allow better handling of streams\r\n\t\t// streams don't emit on undefined\r\n\t\tif (value === null) {\r\n\t\t\telement[attribute] = undefined;\r\n\t\t} else {\r\n\t\t\t// element.setAttribute(attribute, value);\r\n\t\t\telement[attribute] = value;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// remove attributes that are not in props anymore\r\nfunction cleanupAttributes(element, props) {\r\n\tif (element.props !== undefined) {\r\n\t\tfor(let attribute in element.props) {\r\n\t\t\tif (props[attribute] === undefined) {\r\n\t\t\t\telement.removeAttribute(attribute);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction unifyChildren(children) {\r\n\treturn children.map(child => {\r\n\t\t// if there is no tag we assume it's a number or a string\r\n\t\tif (!isStream(child) && child.tag === undefined) {\r\n\t\t\treturn {\r\n\t\t\t\ttag: TEXT_NODE,\r\n\t\t\t\tchildren: [child],\r\n\t\t\t\tversion: 0,\r\n\t\t\t\tcycle: child.cycle || {}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn child;\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction diffChildren(element, newChildren, oldChildren) {\r\n\tlet oldChildNodes = element.childNodes;\r\n\tlet unifiedChildren = unifyChildren(newChildren);\r\n\tlet unifiedOldChildren = unifyChildren(oldChildren);\r\n\r\n\tif (newChildren.length === 0 && oldChildren.length === 0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet i = 0;\r\n\t// diff existing nodes\r\n\tfor(; i < oldChildren.length && i < newChildren.length; i++) {\r\n\t\tlet oldElement = oldChildNodes[i];\r\n\t\tlet {version: oldVersion, children: oldChildChildren} = unifiedOldChildren[i];\r\n\t\tlet {tag, props, children, version} = unifiedChildren[i];\r\n\r\n\t\tdiff(oldElement, tag, props, children, version, oldChildChildren, oldVersion);\r\n\t}\r\n\t\r\n\t// remove not needed nodes at the end\r\n\tfor(let remaining = element.childNodes.length; remaining > newChildren.length; remaining--) {\r\n\t\tlet childToRemove = element.childNodes[remaining - 1];\r\n\t\telement.removeChild(childToRemove);\r\n\r\n\t\tif (unifiedOldChildren.length < remaining) {\r\n\t\t\tconsole.log(\"ZLIQ: Something other then ZLIQ has manipulated the children of the element\", element, \". This can lead to sideffects. Please check your code.\");\r\n\t\t\tcontinue;\r\n\t\t} else {\r\n\t\t\tlet {props} = unifiedOldChildren[remaining - 1];\r\n\r\n\t\t\ttriggerLifecycle(childToRemove, props, 'removed');\r\n\t\t}\r\n\t}\r\n\r\n\t// add new nodes\r\n\tfor(; i < newChildren.length; i++) {\r\n\t\tlet {tag, props, children, version} = unifiedChildren[i];\r\n\t\tlet newElement = createNode(tag, children);\r\n\r\n\t\telement.appendChild(newElement);\r\n\t\tdiff(newElement, tag, props, children, version, [], -1);\r\n\t\ttriggerLifecycle(newElement, props, 'mounted');\r\n\t}\r\n}\r\n\r\n// create text_nodes from numbers or strings\r\n// create domNodes from regular vdom descriptions\r\nexport function createNode(tag, children) {\r\n\tif (tag === TEXT_NODE) {\r\n\t\treturn document.createTextNode(children[0]);\r\n\t} else {\r\n\t\treturn document.createElement(tag);\r\n\t}\r\n}\r\n\r\nfunction copyChildren(oldChildren) {\r\n\tif (oldChildren === undefined) return [];\r\n\r\n\tlet newChildren = JSON.parse(JSON.stringify(oldChildren));\r\n\tnewChildren.forEach((child, index) => {\r\n\t\tif (oldChildren[index].cycle) {\r\n\t\t\tchild.cycle = oldChildren[index].cycle;\r\n\t\t}\r\n\t\t\r\n\t\tif (typeof oldChildren[index] === 'object') {\r\n\t\t\tchild.children = copyChildren(oldChildren[index].children);\r\n\t\t}\r\n\t});\r\n\treturn newChildren;\r\n}\r\n\r\nfunction triggerLifecycle(element, props, event) {\r\n\tif(props && props.cycle && props.cycle[event]) {\r\n\t\tprops.cycle[event](element);\r\n\t}\r\n}\r\n\r\nfunction nodeTypeDiffers(element, tag) {\r\n\treturn element.nodeName.toLowerCase() !== tag;\r\n}\r\n\r\nfunction isTextNode(element) {\r\n\treturn element instanceof window.Text\r\n}\r\n\r\nfunction updateTextNode(element, value) {\r\n\tif (element.nodeValue !== value) {\r\n\t\telement.nodeValue = value;\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils/streamy-dom.js","import {diff, createNode, render} from '../../src'\r\n\r\nexport function test({vdom$}, schedule, done) {\r\n    render({vdom$}).$('element').reduce((iteration, newElement) => {\r\n        if (schedule[iteration] === undefined) {\r\n            throw new Error('Unexpected Update!');\r\n        }\r\n        schedule[iteration](newElement);\r\n        if (schedule.length === iteration + 1 && done) {\r\n            done();\r\n        }\r\n\r\n        return iteration +1;\r\n    }, 0);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./test/helpers/test-component.js","var pSlice = Array.prototype.slice;\nvar objectKeys = require('./lib/keys.js');\nvar isArguments = require('./lib/is_arguments.js');\n\nvar deepEqual = module.exports = function (actual, expected, opts) {\n  if (!opts) opts = {};\n  // 7.1. All identical values are equivalent, as determined by ===.\n  if (actual === expected) {\n    return true;\n\n  } else if (actual instanceof Date && expected instanceof Date) {\n    return actual.getTime() === expected.getTime();\n\n  // 7.3. Other pairs that do not both pass typeof value == 'object',\n  // equivalence is determined by ==.\n  } else if (!actual || !expected || typeof actual != 'object' && typeof expected != 'object') {\n    return opts.strict ? actual === expected : actual == expected;\n\n  // 7.4. For all other Object pairs, including Array objects, equivalence is\n  // determined by having the same number of owned properties (as verified\n  // with Object.prototype.hasOwnProperty.call), the same set of keys\n  // (although not necessarily the same order), equivalent values for every\n  // corresponding key, and an identical 'prototype' property. Note: this\n  // accounts for both named and indexed properties on Arrays.\n  } else {\n    return objEquiv(actual, expected, opts);\n  }\n}\n\nfunction isUndefinedOrNull(value) {\n  return value === null || value === undefined;\n}\n\nfunction isBuffer (x) {\n  if (!x || typeof x !== 'object' || typeof x.length !== 'number') return false;\n  if (typeof x.copy !== 'function' || typeof x.slice !== 'function') {\n    return false;\n  }\n  if (x.length > 0 && typeof x[0] !== 'number') return false;\n  return true;\n}\n\nfunction objEquiv(a, b, opts) {\n  var i, key;\n  if (isUndefinedOrNull(a) || isUndefinedOrNull(b))\n    return false;\n  // an identical 'prototype' property.\n  if (a.prototype !== b.prototype) return false;\n  //~~~I've managed to break Object.keys through screwy arguments passing.\n  //   Converting to array solves the problem.\n  if (isArguments(a)) {\n    if (!isArguments(b)) {\n      return false;\n    }\n    a = pSlice.call(a);\n    b = pSlice.call(b);\n    return deepEqual(a, b, opts);\n  }\n  if (isBuffer(a)) {\n    if (!isBuffer(b)) {\n      return false;\n    }\n    if (a.length !== b.length) return false;\n    for (i = 0; i < a.length; i++) {\n      if (a[i] !== b[i]) return false;\n    }\n    return true;\n  }\n  try {\n    var ka = objectKeys(a),\n        kb = objectKeys(b);\n  } catch (e) {//happens when one is a string literal and the other isn't\n    return false;\n  }\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length != kb.length)\n    return false;\n  //the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n  //~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] != kb[i])\n      return false;\n  }\n  //equivalent values for every corresponding key, and\n  //~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!deepEqual(a[key], b[key], opts)) return false;\n  }\n  return typeof a === typeof b;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./~/deep-equal/index.js","var supportsArgumentsClass = (function(){\n  return Object.prototype.toString.call(arguments)\n})() == '[object Arguments]';\n\nexports = module.exports = supportsArgumentsClass ? supported : unsupported;\n\nexports.supported = supported;\nfunction supported(object) {\n  return Object.prototype.toString.call(object) == '[object Arguments]';\n};\n\nexports.unsupported = unsupported;\nfunction unsupported(object){\n  return object &&\n    typeof object == 'object' &&\n    typeof object.length == 'number' &&\n    Object.prototype.hasOwnProperty.call(object, 'callee') &&\n    !Object.prototype.propertyIsEnumerable.call(object, 'callee') ||\n    false;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./~/deep-equal/lib/is_arguments.js","exports = module.exports = typeof Object.keys === 'function'\n  ? Object.keys : shim;\n\nexports.shim = shim;\nfunction shim (obj) {\n  var keys = [];\n  for (var key in obj) keys.push(key);\n  return keys;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./~/deep-equal/lib/keys.js","import {stream, if$, merge$, flatten} from './';\r\n\r\nfunction interceptLinks(routerState$) {\r\n    // intercepts clicks on links\r\n    // if the link is local '/...' we change the location hash instead\r\n\tfunction interceptClickEvent(e) {\r\n        let target = e.target || e.srcElement;\r\n        if (target.tagName === 'A') {\r\n            let href = target.getAttribute('href');\r\n            let isLocal = href != null && href.startsWith('/');\r\n            let isAnchor = href != null && href.startsWith('#');\r\n\r\n            if (isLocal || isAnchor) {\r\n                let {anchor, route, query} = parseLink(href);\r\n                if (route === undefined) {\r\n                    route = routerState$.value.route;\r\n                }\r\n                goTo(routerState$, anchor, route, query);\r\n                //tell the browser not to respond to the link click\r\n                e.preventDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    // react to HTML5 go back and forward events\r\n    window.onpopstate = function(event) {\r\n        if (event.state) {\r\n            let {route, query} = event.state;\r\n            dispatchRouteChange(routerState$, route, query);\r\n        }\r\n    };\r\n\r\n    // listen for link click events at the document level\r\n    document.addEventListener('click', interceptClickEvent);\r\n\r\n    // react to initial routing info\r\n    if (location.pathname !== '/' || location.search !== \"\") {\r\n        // construct initial routing link\r\n        let href = location.pathname + location.search + location.hash;\r\n        let {route, query} = parseLink(location.pathname + location.search + location.hash);\r\n        dispatchRouteChange(routerState$, route, query);\r\n    }\r\n}\r\n\r\n\r\n// TODO refactor\r\nfunction getUrlParams(hash, search) {\r\n    // match query params in urls like:\r\n    // http://localhost:8080/?code=e4a4f94f008a92f12221&code2=abc#/location?code=e4a4f94f008a92f12221&code2=abc\r\n    // the query could be set internaly; then it would be behind the #\r\n    // the query could be set at start; then it would be before the #\r\n    let urlRegex = /(#\\/\\w*)?(\\?(\\w+=\\w*)(&\\w+=\\w*)*)+(#\\w+)?/g;\r\n    let regExResultHash = RegExp(urlRegex).exec(hash);\r\n    let regExResultSearch = RegExp(urlRegex).exec(search);\r\n\r\n    // merge all query params before and after the hash\r\n    let vars = regExResultHash && regExResultHash[3] != null ? regExResultHash[3].split('&') : [];\r\n    vars = regExResultSearch && regExResultSearch[3] != null ? vars.concat(regExResultSearch[3].split('&')) : vars;\r\n\r\n    let params = {};\r\n    for (var i=0;i<vars.length;i++) {\r\n        var pair = vars[i].split(\"=\");\r\n            // If first entry with this name\r\n        if (typeof params[pair[0]] === \"undefined\") {\r\n            params[pair[0]] = decodeURIComponent(pair[1]);\r\n            // If second entry with this name\r\n        } else if (typeof params[pair[0]] === \"string\") {\r\n            var arr = [ params[pair[0]],decodeURIComponent(pair[1]) ];\r\n            params[pair[0]] = arr;\r\n            // If third or later entry with this name\r\n        } else {\r\n            params[pair[0]].push(decodeURIComponent(pair[1]));\r\n        }\r\n    }\r\n    return params;\r\n}\r\n\r\n// this is an element that shows it's content only if the expected route is met\r\nexport function Router({router$, route}, children$) {\r\n    if (router$ == null) {\r\n        console.log('The Router component needs the routerState$ as attribute.')\r\n        return null;\r\n    }\r\n    if (route == null) {\r\n        console.log('The Router component needs the route as attribute.')\r\n        return null;\r\n    }\r\n    // Register the route\r\n    // this is necessary to decide on a default route\r\n    router$.$('routes')\r\n    // routes can be attached async so we check if the route exists and if not add it\r\n    .map((routes) => routes.indexOf(route) === -1 && router$.patch({ routes: routes.concat(route) }));\r\n\r\n    // check if no registered route was hit and set default if so\r\n    let sanitizedRoute$ = router$\r\n        .map(({route, routes}) => {\r\n            if (routes.indexOf(route) === -1) {\r\n                return '/';\r\n            }\r\n            return route;\r\n        });\r\n\r\n    let routeWasHit$ = sanitizedRoute$.is(route).distinct();\r\n    return merge$([routeWasHit$, children$]).map(([wasHit, children]) => {\r\n        return wasHit ? children : []\r\n    });\r\n}\r\n\r\nexport function initRouter() {\r\n    let routerState$ = stream({\r\n        route: '',\r\n        params: {},\r\n        routes: ['/']\r\n    });\r\n\r\n    interceptLinks(routerState$);\r\n\r\n    return routerState$;\r\n}\r\n\r\n// matching links in the form of /route/subroute?param1=a&param2=b#anchor\r\nfunction parseLink(link) {\r\n    let regexp = /((\\/\\w*)*)?(\\?((\\w+=\\w*)(&(\\w+=\\w*)+)*))?(#(\\w+))?/;\r\n    let matchArr = regexp.exec(link);\r\n    return {\r\n        anchor: matchArr[9],\r\n        route: matchArr[1],\r\n        query: matchArr[4]\r\n    }\r\n}\r\n\r\n// callback for HTML5 navigation events\r\n// save the routing info in the routerState\r\nfunction dispatchRouteChange(routerState$, route, query) {\r\n    // remove hash\r\n    let href = location.hash.substr(1);\r\n    routerState$.patch({\r\n        route: route || '',\r\n        params: getUrlParams(href, location.search)\r\n    });\r\n}\r\n\r\nfunction goTo(routerState$, anchor, route, query) {\r\n    history.pushState({anchor, route, query}, '', `/${route ? route.substr(1) : ''}${query ? '?' + query : ''}`);\r\n    if (anchor) {\r\n       location.hash = '#' + anchor;\r\n    }\r\n    dispatchRouteChange(routerState$, route, query);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils/router.js","import { stream, merge$ } from './';\r\n\r\n// wrapper around promises to provide an indicator if the promise is running\r\nexport const promise$ = (promise) => {\r\n\tlet output$ = stream({\r\n\t\tloading: true,\r\n\t\terror: null,\r\n\t\tdata: null\r\n\t});\r\n\r\n\tpromise.then(result => {\r\n\t\toutput$.patch({\r\n\t\t\tloading: false,\r\n\t\t\tdata: result\r\n\t\t});\r\n\t}, error => {\r\n\t\toutput$.patch({\r\n\t\t\tloading: false,\r\n\t\t\terror\r\n\t\t});\r\n\t});\r\n\r\n\treturn output$;\r\n}\r\n\r\n// provide easy switched on boolean streams\r\n// example use case: <button onclick={()=>open$(!open$())}>{if$(open$, 'Close', 'Open')}</button>\r\nexport function if$(stream, onTrue, onFalse) {\r\n    return stream.map(x=>x?(onTrue||null):(onFalse||null));\r\n}\r\n\r\n// join a mixed array of strings and streams of strings\r\n// example use case: <div class={join$('container', if$(open$, 'open', 'closed'))} />\r\nexport function join$(...arr) {\r\n    let $arr = arr.map(item => {\r\n        if (item === null || item === undefined) {\r\n            return stream('');\r\n        }\r\n        if (item.IS_STREAM) {\r\n            return item;\r\n        }\r\n        return stream(item);\r\n    });\r\n    return merge$($arr).map(arr => arr.join(' '));\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils/streamy-helpers.js","import {stream, merge$, isStream} from './streamy';\r\nimport {createElement, REMOVED, ADDED} from './streamy-dom';\r\n\r\n/*\r\n* wrap hyperscript elements in reactive streams dependent on their children streams\r\n*/\r\nexport const h = (tag, props, ...children) => {\r\n\tlet component;\r\n\tlet version = -1;\r\n\r\n\tlet mergedChildren$ = mergeChildren$(flatten(children));\r\n\t// jsx usually resolves known tags as strings and unknown tags as functions\r\n\t// if it is a sub component, resolve that component\r\n\tif (typeof tag === 'function') {\r\n\t\treturn tag(\r\n\t\t\tprops,\r\n\t\t\tmergedChildren$\r\n\t\t);\r\n\t}\r\n\t// add detachers to props\r\n\tif (props !== null) {\r\n\t\tObject.keys(props).map((propName, index) => {\r\n\t\t\tif (isStream(props[propName])) {\r\n\t\t\t\tprops[propName] = props[propName];\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn {\r\n\t\tvdom$: merge$([\r\n\t\t\t\twrapProps$(props),\r\n\t\t\t\tmergedChildren$.map(flatten)\r\n\t\t\t]).map(([props, children]) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttag,\r\n\t\t\t\t\tprops,\r\n\t\t\t\t\tchildren,\r\n\t\t\t\t\tversion: ++version\r\n\t\t\t}})\r\n\t};\r\n};\r\n\r\n// input has format [stream | {vdom$}]\r\nfunction mergeChildren$(children) {\r\n\tif (!Array.isArray(children)) {\r\n\t\tchildren = [children];\r\n\t}\r\n\tchildren = flatten(children)\r\n\t.filter(_ => _ !== null);\r\n\tlet childrenVdom$arr = children.map(child => {\r\n\t\tif (isStream(child)) {\r\n\t\t\treturn child\r\n\t\t\t.flatMap(mergeChildren$);\r\n\t\t}\r\n\t\treturn child.vdom$ || child;\r\n\t})\r\n\r\n\treturn merge$(childrenVdom$arr);\r\n}\r\n\r\n/*\r\n* wrap all children in streams and merge those\r\n* we make sure that all children streams are flat arrays to make processing uniform\r\n* output: stream([stream([])])\r\n*/\r\nfunction getChildrenVdom$arr(childrenArr) {\r\n\t// flatten children arr\r\n\t// needed to make react style hyperscript (children as arguments) working parallel to preact style hyperscript (children as array)\r\n\tchildrenArr = [].concat(...childrenArr);\r\n\t// only handle vdom for now\r\n\tlet children$Arr = childrenArr.map(component => {\r\n\t\t// if there is no vdom$ it is a string or number\r\n\t\tif (component.vdom$ === undefined) {\r\n\t\t\treturn stream(component);\r\n\t\t}\r\n\t\treturn component.vdom$\r\n\t});\r\n\r\n\treturn children$Arr\r\n\t\t// make sure children are arrays and not nest\r\n\t\t.map(_ => makeArray(_)\r\n\t\t\t.map(flatten))\r\n\t\t// so we can easily merge them\r\n\t\t.map(vdom$ => vdom$.flatMap(vdomArr =>\r\n\t\t\t\tmerge$(vdomArr)));\r\n}\r\n\r\n// make sure all children are handled as streams\r\n// so we can later easily merge them\r\nfunction makeStreams(childrenArr) {\r\n\treturn childrenArr.map(child => {\r\n\t\tif (child === null || !isStream(child)) {\r\n\t\t\treturn stream(child);\r\n\t\t}\r\n\t\treturn child;\r\n\t});\r\n}\r\n\r\n// converts an input into an array\r\nfunction makeArray(stream) {\r\n\treturn stream.map(value => {\r\n\t\tif (value == null) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\tif (!Array.isArray(value)) {\r\n\t\t\treturn [value];\r\n\t\t}\r\n\t\treturn value;\r\n\t})\r\n}\r\n\r\n// flattens an array\r\nexport function flatten(array, mutable) {\r\n    var toString = Object.prototype.toString;\r\n    var arrayTypeStr = '[object Array]';\r\n    \r\n    var result = [];\r\n    var nodes = (mutable && array) || array.slice();\r\n    var node;\r\n\r\n    if (!array.length) {\r\n        return result;\r\n    }\r\n\r\n    node = nodes.pop();\r\n    \r\n    do {\r\n        if (toString.call(node) === arrayTypeStr) {\r\n            nodes.push.apply(nodes, node);\r\n        } else {\r\n            result.push(node);\r\n        }\r\n    } while (nodes.length && (node = nodes.pop()) !== undefined);\r\n\r\n    result.reverse(); // we reverse result to restore the original order\r\n    return result;\r\n}\r\n\r\n/*\r\n* Wrap props into one stream\r\n*/\r\nfunction wrapProps$(props) {\r\n\tif (props === null) return stream({});\r\n\tif (isStream(props)) {\r\n\t\treturn props;\r\n\t}\r\n\r\n\tlet nestedStreams = extractNestedStreams(props);\r\n\tlet updateStreams = nestedStreams.map(function makeNestedStreamUpdateProps({parent, key, stream}) {\r\n\t\treturn stream\r\n\t\t.distinct()\r\n\t\t// here we produce a sideeffect on the props object -> low GC\r\n\t\t// to trigger the merge we also need to return sth (as undefined does not trigger listeners)\r\n\t\t.map(value => {\r\n\t\t\tparent[key] = value;\r\n\t\t\treturn value; \r\n\t\t})\r\n\t});\r\n\treturn merge$(updateStreams).map(_ => props);\r\n}\r\n\r\n// to react to nested streams in an object, we extract the streams and a reference to their position\r\n// returns [{parentObject, propertyName, stream}]\r\nfunction extractNestedStreams(obj) {\r\n\treturn flatten(Object.keys(obj).map(key => {\r\n\t\tif (obj[key] === null) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\tif (typeof obj[key] === 'object') {\r\n\t\t\treturn extractNestedStreams(obj[key]);\r\n\t\t}\r\n\t\tif (isStream(obj[key])) {\r\n\t\t\treturn [{\r\n\t\t\t\tparent: obj,\r\n\t\t\t\tkey,\r\n\t\t\t\tstream: obj[key]\r\n\t\t\t}];\r\n\t\t}\r\n\t\treturn [];\r\n\t}))\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils/streamy-hyperscript.js"],"sourceRoot":""}